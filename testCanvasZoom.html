<!DOCTYPE html>
<html>
<head>
	<title>Canvas Zooming</title>
	<style type="text/css">
		#canvas {
			border: 1px black solid;
		}
	</style>
</head>
<body>
<div>
	<canvas id="canvas" width="900px" height="600px"></canvas>
	<br>
	<button id="canvas-reset">Reset</button>
</div>
</body>
</html>

<script type="text/javascript" src="fyp_webapps/jquery-2.2.0.min.js"></script>
<script type="text/javascript">
var canvasCtx = $("#canvas")[0].getContext('2d');
var img = new Image();
img.addEventListener("load", function() {
	canvasCtx.drawImage(img, 100, 200);
}, false);
img.src = "./fyp_webapps/img/copy-icon.ico";
canvasCtx.fillStyle = '#ff0000';
canvasCtx.rect(0, 0, 900, 600);
drawOnCanvas();

//--- scaling

var dx = 0; var dy = 0;
var zoomVal = 1.0;
var zoomDx = 0; var zoomDy = 0;

$('#canvas').mousedown(function(evt) {
	evt.stopPropagation();

	var prevX = evt.clientX; 
	var prevY = evt.clientY;
	
	$(document).mousemove(function(evt) {
		evt.stopPropagation();
		
		dx += evt.clientX - prevX;
		dy += evt.clientY - prevY;
		
		canvasCtx.clearRect(0, 0, 900, 600);
		
		canvasCtx.translate(zoomDx, zoomDy);
		canvasCtx.scale(zoomVal, zoomVal);
		canvasCtx.translate(dx * (1.0/zoomVal), dy * (1.0/zoomVal));
		
		drawOnCanvas();
		
		canvasCtx.translate(-dx * (1.0/zoomVal), -dy * (1.0/zoomVal));
		canvasCtx.scale(1.0/zoomVal, 1.0/zoomVal);
		canvasCtx.translate(-zoomDx, -zoomDy);

		prevX = evt.clientX;
		prevY = evt.clientY;
	}).mouseup(function() {
		event.stopPropagation();
		$(this).off('mousemove');
		$(this).off('mouseup');
	});
});

$("#canvas").bind('mousewheel', function(evt) {
	evt.stopPropagation();
	if(evt.originalEvent.wheelDelta < 0) {
		//--- scroll down
		zoomVal = +(zoomVal - 0.1).toFixed(2);
	} else {
		//--- scroll up
		zoomVal = +(zoomVal + 0.1).toFixed(2);
	}

	zoomDx = +((1 - zoomVal) * evt.offsetX).toFixed(2);
	zoomDy = +((1 - zoomVal) * evt.offsetY).toFixed(2);

	if (zoomVal > 0) {
		canvasCtx.clearRect(0, 0, 900, 600);
		
		canvasCtx.translate(zoomDx, zoomDy);
		canvasCtx.scale(zoomVal, zoomVal);
		canvasCtx.translate(dx, dy);
		
		drawOnCanvas();
		
		canvasCtx.translate(-dx, -dy);
		canvasCtx.scale(1.0/zoomVal, 1.0/zoomVal);
		canvasCtx.translate(-zoomDx, -zoomDy);
	}

	return false;
});

$('#canvas-reset').click(function() {
	event.stopPropagation();
	canvasCtx.clearRect(0, 0, 900, 600);
	drawOnCanvas();
	dx = 0;
	dy = 0;
	zoomDx = 0;
	zoomDy = 0;
	zoomVal = 1.0;
});

function drawOnCanvas() {
	canvasCtx.fillRect(0, 0, 900, 600);
	canvasCtx.drawImage(img, 100, 200);
}

</script>
