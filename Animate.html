<html>
<head>
	<title>Test Animation</title>
	<link rel="stylesheet" type="text/css" href="waveform.css">
</head>
<body>
	<br><br>
	<div id="waveform">
		<input type="range" class="waveform-slider" value="0">
		<canvas class="waveform-canvas" id="waveform-canvas-left"></canvas>
		<br><br>
		<canvas class="waveform-canvas" id="waveform-canvas-right"></canvas>
	</div>

	<br>

	<div id="drop">
		<h2>drag and drop here!</h2>
	</div>

	<div id="controls">
		<button class="play-pause-btn">play</button>
		<button class="stop-btn">stop</button>
	</div>

</body>

<script type="text/javascript" src="js/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="js/dragAndDropFileLoader.js"></script>
<script type="text/javascript" src="js/visualisations.js"></script>
<script type="text/javascript" src="js/playback.js"></script>

<script type="text/javascript">
	var audioCtx = new AudioContext();
	var soundData = null;

	var animationFrameRequestID = null;
	var scrollValue = 0;
	var playing = false;

	setupBlankWaveformCanvases();

	function setupVisualisations() {
		drawWaveform(soundData);
	}
	
	var then;
	var soundDuration = 5000;	// use AudioBuffer.duration * 1000
	$('.waveform-slider').attr('max', soundDuration);

	function animate(highResTimestamp) {
		animationFrameRequestID = requestAnimationFrame(animate);
		var now = Date.now();
		var diff = now - then;

		if (diff) {
			scrollValue = (scrollValue + diff) % (soundDuration + 1);
			$('.waveform-slider').val(scrollValue);
			then = now;
		 }

	}

	$('.play-pause-btn').click(function() {
		if (!playing) {
			then = Date.now();
			animationFrameRequestID = requestAnimationFrame(animate);
			playing = true;
			soundDuration = soundData.duration * 1000;
			$('.waveform-slider').attr('max', soundDuration);

		} else {
			cancelAnimationFrame(animationFrameRequestID);
			animationFrameRequestID = null;		// TOOD: check if this is neccessary
			playing = false;
			
		}
		
	});

	$('.stop-btn').click(function() {
		cancelAnimationFrame(animationFrameRequestID);
		$('.waveform-slider').val(0);	// reset slider
		scrollValue = 0;
		animationFrameRequestID = null;		// TOOD: check if this is neccessary
		playing = false;
	});

</script>
</html>
