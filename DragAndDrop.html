<html>
<head>
	<title>Drag 'n Drop</title>
	<link rel="stylesheet" type="text/css" href="drag-and-drop.css">
</head>
<body>
	code adapted from: https://github.com/katspaugh/wavesurfer.js/blob/master/example/main.js
	<br><br>
	<div id="drop">
		drag and drop here!
	</div>
</body>

<script type="text/javascript">
	var audioCtx = new AudioContext();
	var bufferSrc = null;
	var songData = null;

	// Drag'n'drop
	document.addEventListener('DOMContentLoaded', function () {
		var toggleActive = function (e, toggle) {
			e.stopPropagation();
			e.preventDefault();
			toggle ? e.target.classList.add('dragover') :
			e.target.classList.remove('dragover');
		};

		var handlers = {
			// Drop event
			drop: function (e) {
				toggleActive(e, false);

				// Load the file into wavesurfer
				if (e.dataTransfer.files.length) {
					console.log("proceed to load Blob");
					loadBlob(e.dataTransfer.files[0]);
				} else {
					console.log("error, not a file");
					// wavesurfer.fireEvent('error', 'Not a file');
				}
			},

			// Drag-over event
			dragover: function (e) {
				toggleActive(e, true);
			},

			// Drag-leave event
			dragleave: function (e) {
				toggleActive(e, false);
			}
		};

		var dropTarget = document.querySelector('#drop');
		Object.keys(handlers).forEach(function (event) {
			dropTarget.addEventListener(event, handlers[event]);
		});
	});

	/**
	 * Loads audio data from a Blob or File object.
	 *
	 * @param {Blob|File} blob Audio data.
	 */
	function loadBlob (blob) {
		// Create file reader
		var reader = new FileReader();
		reader.addEventListener('load', function (e) {
			decodeArrayBuffer(e.target.result);
		});

		reader.readAsArrayBuffer(blob);
	}

	function decodeArrayBuffer (arraybuffer) {
		var offlineAc = new OfflineAudioContext(2, 44100*40, 44100);
		
		// decode data using OfflineAudioContext
		offlineAc.decodeAudioData(arraybuffer, (function (data) {
			// save data locally first
			songData = data;

			// load song to be played
			loadDecodedBuffer(data);

			// play
			play();
		}));
	}

	function loadDecodedBuffer(buffer) {
		bufferSrc = audioCtx.createBufferSource();
		bufferSrc.buffer = buffer;
		bufferSrc.connect(audioCtx.destination);
	}

	function play() {
		if (bufferSrc!=null) {
			bufferSrc.start();

		} else {
			console.log("buffer src not declared yet");
		}
	}

</script>
</html>